<script src="./components/aweit_ds_door/aweit_ds_door.js"></script>
<style>
    .door {
        background-color: #f5f5f5;
    }
    .door:hover  {
        border: 2px solid black !important;
    }
</style>
<div class="mx-auto vh-100 overflow-auto w-sm-100" style="width: 100%;">
    <div id="door_list" 
         class="d-flex flex-row align-items-center overflow-auto w-100 border shadow justify-content-start " 
         style="padding-top: 10px;">
    </div>
    <div class="w-100" style="padding-top: 20px;">
        <div id="door_info" class="mt-3 d-flex flex-column flex-lg-row justify-content-start align-items-center align-items-lg-start">
            <div class="card border border-dark shadow flex-shrink-0 ms-2" style="width: 18rem; height:25rem">
                <img src="" class="door_pic card-img-top">
                <div class="card-body">
                    <h5 class="card-title door_id"></h5>
                    <p class="card-text door_desc"></p>
                </div>
            </div>
            <div class="d-flex flex-row justify-content-center align-items-start mt-3 mt-lg-0 mx-2 w-100 position-relative" style="height:25rem">
                <i class="bi bi-arrow-left-right position-absolute text-dark" style="font-size: 2.5rem; top:45%; font-weight: bolder;"></i>
                <div class="row w-100 h-100">
                    <div class="col-6 shadow">
                        <h5 class="text-center">具有權限的員工</h5>
                        <div id="left" style="height: 90%;" class="" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <p id="E001" class="border border-2 border-primary shadow p-1 m-1" role="button" draggable="true" ondragstart="drag(event)">James</p>
                            <p id="E002" class="border border-2 border-primary shadow p-1 m-1" role="button" draggable="true" ondragstart="drag(event)">Mavis</p>
                            <p id="E003" class="border border-2 border-primary shadow p-1 m-1" role="button" draggable="true" ondragstart="drag(event)">Benson</p>
                        </div>
                    </div>
                    <div class="col-6 shadow">
                        <h5 class="text-center">被移除權限的員工</h5>
                        <div id="right" style="height: 90%;" class="" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <p id="E004" class="border border-2 border-danger shadow p-1 m-1" role="button" draggable="true" ondragstart="drag(event)">Yushu</p>
                            <p id="E005" class="border border-2 border-danger shadow p-1 m-1" role="button" draggable="true" ondragstart="drag(event)">Rosa</p>
                            <p id="E006" class="border border-2 border-danger shadow p-1 m-1" role="button" draggable="true" ondragstart="drag(event)">Weizhi</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="m-3 d-flex justify-content-center">
        <button class="btn btn-primary m-3">提交</button>
        <button class="btn btn-danger m-3">清除</button>
        <br>
    </div>
</div>
</div>

<script>

    var doorList = [];

    $.ajax({
        async:false,
        url:'./api/ds_door.json',
        dataType: 'json',
        success: function(doors) {
            doorList = doors;   
        }
    });

    doorList.forEach(render); 

    function render(door,index) {
        let ds_door =
         ` 
            <div class="border door flex-shrink-0">
                <aweit-ds-door type="door" door_id="${door.door_id}" door_name="${door.door_name}" door_pic="${door.door_pic}" door_desc="${door.door_desc}"></aweit-ds-door>
            </div>
        `;
        $('#door_list').append(ds_door);
    }

    document.querySelectorAll('aweit-ds-door').forEach(register);

    function register(door,index) {
        door.registerClickHandler(() => tap(door));
    }

    function tap(door) {
        let door_id = door.getAttribute('door_id');
        let door_name = door.getAttribute('door_name');
        let door_pic = door.getAttribute('door_pic');
        let door_desc = door.getAttribute('door_desc');
        $('#door_info').removeClass('d-none');
        $('#door_info .door_id').html(`${door_id}(${door_name})`);
        $('#door_info .door_pic').attr('src',door_pic);
        $('#door_info .door_desc').html(`${door_desc}`);
    }

    function allowDrop(event) {
        event.preventDefault();
    }

    function drag(event) {
        event.dataTransfer.setData('employee_name', event.target.innerText);
        event.dataTransfer.setData('employee_id', event.target.id);
    }

    function drop(event) {
        event.preventDefault();
        var employee_name = event.dataTransfer.getData('employee_name');
        var employee_id = event.dataTransfer.getData('employee_id');
        var targetId = event.target.id;
        var sourceId = (targetId == 'right') ? 'left': 'right';
        var employee = document.getElementById(employee_id);
        //console.log(`${employee_name} (${employee_id}) 從 ${sourceId} 到 ${targetId}`);
        var sourcebox = document.getElementById(sourceId);
        sourcebox.removeChild(employee);
        var targetbox = document.getElementById(targetId);
        targetbox.appendChild(employee);
    }



</script>